sap.ui.define(["sap/ui/core/Control"],function(e){return e.extend("encollab.dp.controls.FileUploader",{metadata:{properties:{enabled:{type:"boolean",defaultValue:true},csv:{type:"boolean",defaultValue:true},allowMultiple:{type:"boolean",defaultValue:true}},events:{data:{},error:{}}},attached:false,mimes:["application/vnd.ms-excel","text/csv"],init:function(){this.available=this._detectFileReaderSupport()&&this._detectDragAndDropSupport()},_detectFileReaderSupport:function(){return!!FileReader},_detectDragAndDropSupport:function(){var e=document.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},renderer:function(e,t){e.write('<div class="fileuploader" ');e.writeControlData(t);e.addStyle("position","fixed");e.addStyle("top","0");e.addStyle("left","0");e.addStyle("width","100%");e.addStyle("height","100%");e.addStyle("background","rgba(255,255,255,0.6)");e.addStyle("visibility","hidden");e.addStyle("color","#009de0");e.addStyle("font-size","15em");e.addStyle("text-align","center");e.addStyle("line-height","500px");e.addStyle("font-family","SAP-icons");e.addStyle("z-index","99999");e.writeStyles();e.write(">&#57881</div>")},onAfterRendering:function(){var e=$("#"+this.getId());var i=$(window);if(e[0]){e=e[0]}function a(){e.style.visibility="visible"}function r(){e.style.visibility="hidden"}function n(e){if(true){e.dataTransfer.dropEffect="copy";e.preventDefault()}}function d(e){e.preventDefault();r();try{var i=e.target.files||e.dataTransfer.files;if(this.getCsv()===true){var a=i[0];if(this.mimes.indexOf(a.type)>=0&&a.name.match(/xlsx?$/i)===null){var n=new FileReader;n.onload=function(e){var r=t(n.result,",");this.fireData({data:r,name:a.name,size:a.size,modified:a.lastModified,success:true,message:i.length>1?"Only one file processed":"Processing OK"})}.bind(this);n.readAsText(a)}else{this.fireError({name:a.name,type:a.type,message:'File "'+a.name+'" ('+a.type+") is not a CSV"})}}else{this.fireData({files:i})}}catch(e){this.fireError({message:"This feature is not supported by your browser"})}}if(this.available===true&&this.getEnabled()===true){i.on("dragenter",function(e){a()});i.on("drop",function(e){e.preventDefault()});e.addEventListener("dragenter",n);e.addEventListener("dragover",n);e.addEventListener("dragleave",function(e){r()});e.addEventListener("drop",d.bind(this));r();this.attached=true}}});function t(e,t){t=t||",";var i=new RegExp("(\\"+t+"|\\r?\\n|\\r|^)"+'(?:"([^"]*(?:""[^"]*)*)"|'+'([^"\\'+t+"\\r\\n]*))","gi");var a=[[]];try{var r=null;var n="";while(r=i.exec(e)){var d=r[1];if(d.length&&d!=t){a.push([])}if(r[2]){n=r[2].replace(new RegExp('""',"g"),'"')}else{n=r[3]}a[a.length-1].push(n)}}catch(e){console.log("Errors parsing CSV. Is this a CSV?")}return a}});
//# sourceMappingURL=FileUploader.js.map